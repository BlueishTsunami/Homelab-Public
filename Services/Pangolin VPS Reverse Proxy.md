# #rishi-station

# Summary

`rishi-station` is a Reverse Proxy and tunneling service running on a Racknerd VPS. it is using pangolin, a bundle of `traefik` as the proxy, `gerbil` and `newt` as tunneling services, and `pangolin` as a front end with authentication. This allows me to expose services by port securely to the web with authentication in front. 

# Hardware

Racknerd VPS
Debain 12 Linux 64bit

| memory     | 2 GB           |
| ---------- | -------------- |
| storage    | 25 GB          |
| processors | 1 VCPU         |

# Summary
https://github.com/fosrl/pangolin
This VPS is using pangolin, a reverse proxy and VPN tunneling solution using Traefik. The purpose is to act as an exit node for any traffic in my network, providing a public VPS IP rather than my home network. This box is mapped to the domain that I own, and uses Traefik to assign subdomains to different services on the home network. 

Pangolin uses `newt`, a WireGuard tunnel client, to establish tunnels between the VPS and the home network. This box is currently running 2 newt tunnels to home network, one for the DMZ net, and one for the home network. The newt clients are running on 2 LXC's in `kepler`.

# VPS Install and Setup

Follow the standard [[Host Setup]] guide and follow the SSH instructions. Keychain is not required here since this host will not be initiating ssh connections often. 

# Pangolin Setup

## Links
https://github.com/fosrl/pangolin
https://docs.fossorial.io/Getting%20Started/quick-install

## File structure

Per the doc:

Anything marked with `(*)` will not be generated on startup of the stack. The volumes are created by the Docker Compose file, and most of the files are generated by the Pangolin and Gerbil services.

You will need to create the `traefik_config.yml` and `dynamic_config.yml` files manually and edit them to your needs. You can start the stack without the Traefik config files to let Pangolin generate everything. Traefik will throw some errors, but you can ignore this on first startup. 

I slapped this all into a folder `/srv/pangolin/`.

```
├── config/
│   ├── config.yml (*)
│   ├── db/
│   │   └── db.sqlite
│   ├── key
│   ├── letsencrypt/
│   │   └── acme.json
│   ├── logs/
│   └── traefik/
│       ├── traefik_config.yml (*)
│       └── dynamic_config.yml (*)
└── docker-compose.yml (*)
```

## Docker Setup

Three files will need to be created to setup via docker compose. We also need to install docker / docker compose. 

Docker compose install: 
![[lxsetup-docker 1.txt]]

Docker compose required files: 

### Docker Compose File - `docker-compose.yml` 
![[docker-compose 1.yml]]
### Traefik Config File - `config/traefik/traefik_config.yml` 
![[traefik_config1.yml]]

Main thing in here was just adding my email under cert resolver: 

```
certificatesResolvers:
  letsencrypt:
    acme:
      caServer: https://acme-v02.api.letsencrypt.org/directory
      email: <insert_email>
      httpChallenge:
        entryPoint: web
      storage: /letsencrypt/acme.json
```


### Dynamic Config - `config/traefik/dynamic_config.yml`

Make sure to update the routing settings in this file to point to your owned domain:

```yml
routers:
    api-router:
      entryPoints:
        - websecure
      middlewares:
        - security-headers
      rule: Host(`<insert_domain>`) && PathPrefix(`/api/v1`)
      service: api-service
      tls:
        certResolver: letsencrypt
    main-app-router-redirect:
      entryPoints:
        - web
      middlewares:
        - redirect-to-https
      rule: Host(`<insert_domain>`)
      service: next-service
    next-router:
      entryPoints:
        - websecure
      middlewares:
        - security-headers
      rule: Host(`<insert_domain>`) && !PathPrefix(`/api/v1`)
      service: next-service
      tls:
        certResolver: letsencrypt
    ws-router:
      entryPoints:
        - websecure
      middlewares:
        - security-headers
      rule: Host(`<insert_domain>`)
      service: api-service
      tls:
        certResolver: letsencrypt
```

# Fail2Ban setup

Follow the [[Host Setup#Fail2Ban setup]]